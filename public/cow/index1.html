<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>CowTrack — Smart Livestock Management</title>
<link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
<style>
  body { font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; background: #f8fafc; }
  .glass-effect { background: rgba(255,255,255,0.92); backdrop-filter: blur(6px); border: 1px solid rgba(0,0,0,0.04); }
  .mic-btn{ position:absolute; right:8px; top:50%; transform:translateY(-50%); background:#10b981; color:white; width:34px; height:34px; display:flex; align-items:center; justify-content:center; border-radius:9999px; cursor:pointer;}
  .hidden{display:none;}
  .fade-in { animation: fadeIn .35s ease both; }
  @keyframes fadeIn { from { opacity: 0; transform: translateY(6px);} to { opacity: 1; transform: translateY(0);} }
  .notification { position: fixed; top: 20px; right: 20px; padding: 12px 16px; border-radius:8px; color:white; display:none; z-index:60; }
  .notif-success{ background:#10b981; } .notif-error{ background:#ef4444; } .notif-info{ background:#3b82f6; }
</style>
</head>
<body>
<nav class="bg-gradient-to-r from-green-600 to-blue-600 text-white p-4 shadow-md">
  <div class="max-w-7xl mx-auto flex items-center justify-between">
    <div class="flex items-center gap-4">
      <div class="bg-white rounded-full p-2 text-green-600"><i class="fas fa-cow fa-lg"></i></div>
      <div>
        <div class="text-xl font-bold">CowTrack</div>
        <div class="text-sm opacity-90">Smart Livestock Management</div>
      </div>
    </div>
    <div class="flex items-center gap-4">
      <button id="nav-home" class="px-3 py-1 hover:bg-white/10 rounded">Home</button>
      <button id="nav-register" class="px-3 py-1 hover:bg-white/10 rounded">Register</button>
      <button id="nav-search" class="px-3 py-1 hover:bg-white/10 rounded">Search</button>
      <button id="nav-analytics" class="px-3 py-1 hover:bg-white/10 rounded">Analytics</button>
    </div>
  </div>
</nav>
<div id="notification" class="notification"></div>
<main class="max-w-7xl mx-auto p-6 space-y-8">
  <section id="page-home" class="fade-in">
    <div class="grid md:grid-cols-3 gap-6">
      <div class="glass-effect p-6 rounded-lg shadow">
        <h2 class="text-2xl font-bold">Welcome</h2>
        <p class="text-gray-600 mt-2">CowTrack — digital health profiles, QR tagging, vaccination scheduling, pregnancy & heat tracking.</p>
        <div class="mt-4 text-sm text-gray-700">Total Registered: <span id="stat-total" class="font-bold">0</span></div>
      </div>
      <div class="glass-effect p-6 rounded-lg shadow">
        <h3 class="font-semibold">Quick Actions</h3>
        <div class="grid gap-3 mt-3">
          <button id="cta-register" class="bg-green-600 text-white rounded px-4 py-2">Register Cow</button>
          <button id="cta-search" class="bg-blue-600 text-white rounded px-4 py-2">Search Profile</button>
        </div>
      </div>
      <div class="glass-effect p-6 rounded-lg shadow">
        <h3 class="font-semibold">Recent Activity</h3>
        <ul id="recent-list" class="mt-3 text-sm text-gray-700"></ul>
      </div>
    </div>
  </section>
  <section id="page-register" class="hidden">
    <div class="glass-effect p-6 rounded-lg shadow">
      <h2 class="text-2xl font-bold mb-4">Register New Livestock</h2>
      <form id="registerForm" class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div class="space-y-4">
          <div class="relative">
            <label class="block text-sm font-medium mb-1">Cow Name</label>
            <input id="cow_name" name="cow_name" class="w-full border rounded px-3 py-2" required>
            <div class="mic-btn" onclick="startSpeech('cow_name')"><i class="fas fa-microphone"></i></div>
          </div>
          <div class="relative">
            <label class="block text-sm font-medium mb-1">Tag Number</label>
            <input id="tag_number" name="tag_number" class="w-full border rounded px-3 py-2" required>
          </div>
          <div class="relative">
            <label class="block text-sm font-medium mb-1">Breed</label>
            <input id="breed" name="breed" class="w-full border rounded px-3 py-2">
          </div>
          <div class="relative">
            <label class="block text-sm font-medium mb-1">Birth Date</label>
            <input id="birth_date" name="birth_date" type="date" class="w-full border rounded px-3 py-2">
          </div>
          <div class="relative">
            <label class="block text-sm font-medium mb-1">Owner Name</label>
            <input id="owner_name" name="owner_name" class="w-full border rounded px-3 py-2">
            <div class="mic-btn" onclick="startSpeech('owner_name')"><i class="fas fa-microphone"></i></div>
          </div>
          <div class="relative">
            <label class="block text-sm font-medium mb-1">Owner Contact</label>
            <input id="owner_contact" name="owner_contact" class="w-full border rounded px-3 py-2">
          </div>
        </div>
        <div class="space-y-4">
          <div class="relative">
            <label class="block text-sm font-medium mb-1">Medical History</label>
            <textarea id="medical_history" name="medical_history" class="w-full border rounded px-3 py-2" rows="4"></textarea>
            <div class="mic-btn" onclick="startSpeech('medical_history')"><i class="fas fa-microphone"></i></div>
          </div>
          <div class="grid grid-cols-2 gap-2">
            <div>
              <label class="block text-sm font-medium mb-1">Vaccine Name</label>
              <input id="vaccine_name" name="vaccine_name" class="w-full border rounded px-3 py-2">
            </div>
            <div>
              <label class="block text-sm font-medium mb-1">Vaccine Date</label>
              <input id="vaccine_date" name="vaccine_date" type="date" class="w-full border rounded px-3 py-2">
            </div>
          </div>
          <div>
            <label class="block text-sm font-medium mb-1">Next Vaccination Date</label>
            <input id="next_vaccination" name="next_vaccination" type="date" class="w-full border rounded px-3 py-2">
          </div>
          <div class="relative">
            <label class="block text-sm font-medium mb-1">Pregnancy Status / Notes</label>
            <textarea id="pregnancy_notes" name="pregnancy_notes" class="w-full border rounded px-3 py-2" rows="3"></textarea>
            <div class="mic-btn" onclick="startSpeech('pregnancy_notes')"><i class="fas fa-microphone"></i></div>
          </div>
          <div class="relative">
            <label class="block text-sm font-medium mb-1">Passkey (for editing)</label>
            <input id="passkey" name="passkey" type="password" class="w-full border rounded px-3 py-2" required>
          </div>
        </div>
        <div class="md:col-span-2 flex justify-end gap-3 mt-2">
          <button type="button" id="cancelRegister" class="px-4 py-2 rounded bg-gray-200">Cancel</button>
          <button type="submit" class="px-4 py-2 rounded bg-green-600 text-white">Register Livestock</button>
        </div>
      </form>
      <div id="registerResult" class="hidden mt-4 p-4 border rounded glass-effect">
        <h4 class="font-semibold">Registered Successfully</h4>
        <p id="regMsg" class="text-sm text-gray-700"></p>
        <div id="qrContainer" class="mt-3"></div>
      </div>
    </div>
  </section>
  <section id="page-search" class="hidden">
    <div class="glass-effect p-6 rounded shadow">
      <h2 class="text-2xl font-bold mb-4">Search Livestock Profile</h2>
      <div class="flex gap-3 mb-4">
        <input id="search_input" placeholder="Enter Tag Number" class="flex-1 border rounded px-3 py-2" />
        <button id="btnSearch" class="px-4 py-2 bg-blue-600 text-white rounded">Search</button>
      </div>
      <div id="searchOutput"></div>
    </div>
  </section>
  <section id="page-analytics" class="hidden">
    <div class="glass-effect p-6 rounded shadow">
      <h2 class="text-2xl font-bold mb-4">Analytics</h2>
      <p class="text-gray-600">Charts and analytics (placeholder)</p>
    </div>
  </section>
</main>
<script>
const API_BASE = '/api/cow';
const pageHome = document.getElementById('page-home');
const pageRegister = document.getElementById('page-register');
const pageSearch = document.getElementById('page-search');
const pageAnalytics = document.getElementById('page-analytics');
document.getElementById('nav-home').addEventListener('click', ()=>show(pageHome));
document.getElementById('nav-register').addEventListener('click', ()=>show(pageRegister));
document.getElementById('nav-search').addEventListener('click', ()=>show(pageSearch));
document.getElementById('nav-analytics').addEventListener('click', ()=>show(pageAnalytics));
document.getElementById('cta-register').addEventListener('click', ()=>show(pageRegister));
document.getElementById('cta-search').addEventListener('click', ()=>show(pageSearch));
show(pageHome);
loadStats();
loadRecent();
function show(el){ [pageHome,pageRegister,pageSearch,pageAnalytics].forEach(p=>p.classList.add('hidden')); el.classList.remove('hidden'); window.scrollTo(0,0); }
function notify(msg,type='success'){ const n=document.getElementById('notification'); n.textContent=msg; n.className='notification '+(type==='error'?'notif-error':type==='info'?'notif-info':'notif-success'); n.style.display='block'; setTimeout(()=>n.style.display='none',3500); }
async function loadStats(){ try{ const res=await fetch(API_BASE); const cows=await res.json(); document.getElementById('stat-total').textContent=cows.length; let recent=document.getElementById('recent-list'); recent.innerHTML=''; cows.slice(-5).reverse().forEach(c=>{ const li=document.createElement('li'); li.className='text-sm text-gray-700'; li.textContent=`${c.name||c.cowName||'Cow'} · ${c.tagNumber||''}`; recent.appendChild(li); }); }catch(err){ console.error('loadStats',err); } }
function loadRecent(){}
document.getElementById('registerForm').addEventListener('submit', async function(e){ e.preventDefault(); const payload={ name: document.getElementById('cow_name').value, cowName: document.getElementById('cow_name').value, tagNumber: document.getElementById('tag_number').value, breed: document.getElementById('breed').value, birthDate: document.getElementById('birth_date').value||null, ownerName: document.getElementById('owner_name').value, ownerContact: document.getElementById('owner_contact').value, medicalHistory: document.getElementById('medical_history').value, vaccinations: (document.getElementById('vaccine_name').value ? [{name:document.getElementById('vaccine_name').value, date: document.getElementById('vaccine_date').value || new Date()}] : []), nextVaccinationDate: document.getElementById('next_vaccination').value || null, pregnancyRecords: (document.getElementById('pregnancy_notes').value ? [{notes: document.getElementById('pregnancy_notes').value}] : []), passkeyHash: document.getElementById('passkey').value }; try{ const resp=await fetch(API_BASE,{ method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(payload) }); const data=await resp.json(); if(resp.ok && data.success){ document.getElementById('registerResult').classList.remove('hidden'); document.getElementById('regMsg').textContent=`Cow saved with id ${data.cow._id||data.cow.id}`; const qrContainer=document.getElementById('qrContainer'); qrContainer.innerHTML=''; if(data.cow.qrCode){ const img=document.createElement('img'); img.src=data.cow.qrCode; img.alt='QR'; img.className='w-48 mx-auto border p-2 rounded'; qrContainer.appendChild(img); } else { const canvas=document.createElement('canvas'); qrContainer.appendChild(canvas); if(window.QRCode && QRCode.toCanvas){ QRCode.toCanvas(canvas, `${location.origin}/cow/${data.cow._id||data.cow.id}`, {width:180}).catch(()=>{}); } } notify('Cow registered successfully','success'); loadStats(); document.getElementById('registerForm').reset(); } else { notify(data.message||'Failed to register','error'); } }catch(err){ console.error(err); notify('Server error: could not save','error'); } });
document.getElementById('btnSearch').addEventListener('click', async function(){ const tag=document.getElementById('search_input').value.trim(); if(!tag){ notify('Please enter tag number','error'); return; } try{ const res=await fetch(API_BASE); const cows=await res.json(); const cow=cows.find(c=> (c.tagNumber||'').toLowerCase()===tag.toLowerCase()); const out=document.getElementById('searchOutput'); if(!cow){ out.innerHTML='<div class="p-4 text-red-600">No cow found</div>'; return; } out.innerHTML=`<div class="p-4 border rounded-md"><h3 class="text-xl font-bold mb-2">${cow.name||cow.cowName}</h3><p><b>Tag:</b> ${cow.tagNumber}</p><p><b>Owner:</b> ${cow.ownerName||'-'}</p><p><b>Breed:</b> ${cow.breed||'-'}</p><p><b>Medical:</b> ${cow.medicalHistory||'-'}</p><div id="qrArea" class="mt-3"></div></div>`; const qrArea=document.getElementById('qrArea'); if(cow.qrCode){ qrArea.innerHTML=`<img src="${cow.qrCode}" class="w-40 h-40 mx-auto border p-2 rounded" />`; } else { const canvas=document.createElement('canvas'); qrArea.appendChild(canvas); if(window.QRCode && QRCode.toCanvas){ QRCode.toCanvas(canvas, `${location.origin}/cow/${cow._id||cow.id}`, {width:160}).catch(()=>{}); } } }catch(err){ console.error(err); notify('Search failed','error'); } });
function startSpeech(elId){ if(!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)){ alert('Speech recognition not supported in this browser.'); return; } const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition; const rec = new SpeechRecognition(); rec.lang='en-IN'; rec.interimResults=false; rec.maxAlternatives=1; rec.start(); rec.onresult = (evt) => { const txt = evt.results[0][0].transcript; const el = document.getElementById(elId); if(el) el.value = txt; }; rec.onerror = (e)=> console.warn('Speech error',e); }
(function(){ loadStats(); })();
</script>
<script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.1/build/qrcode.min.js"></script>
</body>
</html>
